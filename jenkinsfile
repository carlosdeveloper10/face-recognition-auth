pipeline {
    agent {
        label 'linux-mint'
    }


	stages {
		stage('Show agent machine info and status') {
			steps {
			    sh 'echo list of enviromet variables'
			    sh 'env'
			    
			    sh 'echo agent machine attributes'
			    sh 'lscpu'
			    sh 'free -h'
			    sh 'dmesg | head -1'
			}
		   
		}

	    stage('Run unit test') {
    	   steps {
    	   		sh 'mvn test'
   	    	}
    	}
	
	stage('build && SonarQube analysis') {
		    steps {
			withSonarQubeEnv('sonarServer') {
			
				sh '${scannerHome}/bin/sonar-scanner'
			    
			}
		    }
		}
	}
	
	post {
	    always {
    	    junit 'target/surefire-reports/TEST-*xml'
    	}
	}
}
